#!/usr/bin/env sh

# Try to get upstream; empty if none set
UPSTREAM=$(git rev-parse --abbrev-ref --symbolic-full-name @{u} 2>/dev/null)

if [ -z "$UPSTREAM" ]; then
  echo "pre-push: no upstream configured yet; running broad tests"
  # first push of a branch â†’ choose one:
  pnpm -r --filter "./apps/**" --filter "./packages/**" --filter "./tokens/**" test || exit 1
else
  echo "pre-push: upstream is $UPSTREAM; running tests"
  # optional: run targeted tests using changed paths vs upstream
  CHANGED=$(git diff --name-only "$UPSTREAM"...HEAD)
  # your per-workspace routing here, or just run full suite:
  pnpm -r --filter "./apps/**" --filter "./packages/**" --filter "./tokens/**" test || exit 1
fi
